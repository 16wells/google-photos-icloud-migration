#!/usr/bin/env python3
"""Script to create icloud_uploader.py on the VM from base64 encoded content."""
import base64

# Base64 encoded icloud_uploader.py content
encoded_content = '''IiIiClVwbG9hZCBtZWRpYSBmaWxlcyB0byBpQ2xvdWQgUGhvdG9zIHVzaW5nIHB5aWNsb3VkIGxpYnJhcnkuCiIiIgppbXBvcnQgbG9nZ2luZwppbXBvcnQgdGltZQpmcm9tIHBhdGhsaWIgaW1wb3J0IFBhdGgKZnJvbSB0eXBpbmcgaW1wb3J0IExpc3QsIERpY3QsIE9wdGlvbmFsLCBDYWxsYWJsZQpmcm9tIHB5aWNsb3VkIGltcG9ydCBQeWlDbG91ZFNlcnZpY2UKZnJvbSBweWljbG91ZC5leGNlcHRpb25zIGltcG9ydCBQeWlDbG91ZEZhaWxlZExvZ2luRXhjZXB0aW9uLCBQeWlDbG91ZDJTQVJlcXVpcmVkRXhjZXB0aW9uCmZyb20gdHFkbSBpbXBvcnQgdHFkbQoKbG9nZ2VyID0gbG9nZ2luZy5nZXRMb2dnZXIoX19uYW1lX18pCgoKY2xhc3MgaUNsb3VkVXBsb2FkZXI6CiAgICAiIiJIYW5kbGVzIHVwbG9hZGluZyBtZWRpYSBmaWxlcyB0byBpQ2xvdWQgUGhvdG9zLiIiIgogICAgCiAgICBkZWYgX19pbml0X18oc2VsZiwgYXBwbGVfaWQ6IHN0ciwgcGFzc3dvcmQ6IHN0ciwgCiAgICAgICAgICAgICAgICAgdHJ1c3RlZF9kZXZpY2VfaWQ6IE9wdGlvbmFsW3N0cl0gPSBOb25lKToKICAgICAgICAiIiIKICAgICAgICBJbml0aWFsaXplIHRoZSBpQ2xvdWQgdXBsb2FkZXIuCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYXBwbGVfaWQ6IEFwcGxlIElEIGVtYWlsCiAgICAgICAgICAgIHBhc3N3b3JkOiBBcHBsZSBJRCBwYXNzd29yZCAoZW1wdHkgc3RyaW5nIHdpbGwgcHJvbXB0KQogICAgICAgICAgICB0cnVzdGVkX2RldmljZV9pZDogT3B0aW9uYWwgdHJ1c3RlZCBkZXZpY2UgSUQgZm9yIDJGQQogICAgICAgICIiIgogICAgICAgIHNlbGYuYXBwbGVfaWQgPSBhcHBsZV9pZAogICAgICAgIHNlbGYucGFzc3dvcmQgPSBwYXNzd29yZC5zdHJpcCgpIGlmIHBhc3N3b3JkIGVsc2UgJycKICAgICAgICBzZWxmLnRydXN0ZWRfZGV2aWNlX2lkID0gdHJ1c3RlZF9kZXZpY2VfaWQKICAgICAgICBzZWxmLmFwaSA9IE5vbmUKICAgICAgICAKICAgICAgICAjIFByb21wdCBmb3IgcGFzc3dvcmQgaWYgZW1wdHkKICAgICAgICBpZiBub3Qgc2VsZi5wYXNzd29yZDoKICAgICAgICAgICAgaW1wb3J0IGdldHBhc3MKICAgICAgICAgICAgbG9nZ2VyLmluZm8oImlDbG91ZCBwYXNzd29yZCBub3QgcHJvdmlkZWQuIFBsZWFzZSBlbnRlciB5b3VyIEFwcGxlIElEIHBhc3N3b3JkOiIpCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCIoTm90ZTogSWYgeW91IGhhdmUgMkZBIGVuYWJsZWQsIHVzZSB5b3VyIHJlZ3VsYXIgcGFzc3dvcmQpIikKICAgICAgICAgICAgc2VsZi5wYXNzd29yZCA9IGdldHBhc3MuZ2V0cGFzcygiUGFzc3dvcmQ6ICIpCiAgICAgICAgCiAgICAgICAgc2VsZi5fYXV0aGVudGljYXRlKCkKICAgIAogICAgZGVmIF9hdXRoZW50aWNhdGUoc2VsZik6CiAgICAgICAgIiIiQXV0aGVudGljYXRlIHdpdGggaUNsb3VkLiIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5hcGkgPSBQeWlDbG91ZFNlcnZpY2Uoc2VsZi5hcHBsZV9pZCwgc2VsZi5wYXNzd29yZCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgSGFuZGxlIDJGQSBpZiByZXF1aXJlZAogICAgICAgICAgICBpZiBzZWxmLmFwaS5yZXF1aXJlc18yZmE6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiVHdvLWZhY3RvciBhdXRoZW50aWNhdGlvbiByZXF1aXJlZCIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHNlbGYudHJ1c3RlZF9kZXZpY2VfaWQ6CiAgICAgICAgICAgICAgICAgICAgIyBVc2UgdHJ1c3RlZCBkZXZpY2UKICAgICAgICAgICAgICAgICAgICBkZXZpY2UgPSBzZWxmLmFwaS50cnVzdGVkX2RldmljZXNbaW50KHNlbGYudHJ1c3RlZF9kZXZpY2VfaWQpXQogICAgICAgICAgICAgICAgICAgIGRldmljZV9uYW1lID0gZGV2aWNlLmdldCgnZGV2aWNlTmFtZScsICdVbmtub3duJykKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlVzaW5nIHRydXN0ZWQgZGV2aWNlOiB7ZGV2aWNlX25hbWV9IikKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5hcGkuc2VuZF92ZXJpZmljYXRpb25fY29kZShkZXZpY2UpOgogICAgICAgICAgICAgICAgICAgICAgICByYWlzZSBFeGNlcHRpb24oIkZhaWxlZCB0byBzZW5kIHZlcmlmaWNhdGlvbiBjb2RlIikKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIlZlcmlmaWNhdGlvbiBjb2RlIHNlbnQgdG8ge2RldmljZV9uYW1lfSIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICMgTGlzdCBhdmFpbGFibGUgZGV2aWNlcwogICAgICAgICAgICAgICAgICAgIGRldmljZXMgPSBzZWxmLmFwaS50cnVzdGVkX2RldmljZXMKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiQXZhaWxhYmxlIHRydXN0ZWQgZGV2aWNlczoiKQogICAgICAgICAgICAgICAgICAgIGZvciBpLCBkZXZpY2UgaW4gZW51bWVyYXRlKGRldmljZXMpOgogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VfbmFtZSA9IGRldmljZS5nZXQoJ2RldmljZU5hbWUnLCAnVW5rbm93bicpCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZV90eXBlID0gZGV2aWNlLmdldCgnZGV2aWNlVHlwZScsICdVbmtub3duJykKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiIgIHtpfToge2RldmljZV9uYW1lfSAoe2RldmljZV90eXBlfSkiKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGRldmljZV9pbmRleCA9IGlucHV0KCJTZWxlY3QgZGV2aWNlIChlbnRlciBudW1iZXIpOiAiKS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlID0gZGV2aWNlc1tpbnQoZGV2aWNlX2luZGV4KV0KICAgICAgICAgICAgICAgICAgICBkZXZpY2VfbmFtZSA9IGRldmljZS5nZXQoJ2RldmljZU5hbWUnLCAnVW5rbm93bicpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuYXBpLnNlbmRfdmVyaWZpY2F0aW9uX2NvZGUoZGV2aWNlKToKICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJGYWlsZWQgdG8gc2VuZCB2ZXJpZmljYXRpb24gY29kZSIpCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJWZXJpZmljYXRpb24gY29kZSBzZW50IHRvIHtkZXZpY2VfbmFtZX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEFsbG93IHJldHJpZXMgZm9yIDJGQSBjb2RlCiAgICAgICAgICAgICAgICBtYXhfYXR0ZW1wdHMgPSAzCiAgICAgICAgICAgICAgICBmb3IgYXR0ZW1wdCBpbiByYW5nZShtYXhfYXR0ZW1wdHMpOgogICAgICAgICAgICAgICAgICAgIGNvZGUgPSBpbnB1dChmIkVudGVyIDJGQSBjb2RlIChhdHRlbXB0IHthdHRlbXB0ICsgMX0ve21heF9hdHRlbXB0c30pOiAiKS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgIyBSZW1vdmUgYW55IHNwYWNlcyBvciBkYXNoZXMgZnJvbSB0aGUgY29kZQogICAgICAgICAgICAgICAgICAgIGNvZGUgPSBjb2RlLnJlcGxhY2UoJyAnLCAnJykucmVwbGFjZSgnLScsICcnKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuYXBpLnZhbGlkYXRlX3ZlcmlmaWNhdGlvbl9jb2RlKGRldmljZSwgY29kZSk6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLinJMgVmVyaWZpY2F0aW9uIGNvZGUgYWNjZXB0ZWQiKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGF0dGVtcHQgPCBtYXhfYXR0ZW1wdHMgLSAxOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkludmFsaWQgdmVyaWZpY2F0aW9uIGNvZGUuIFBsZWFzZSB0cnkgYWdhaW4uIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJOb3RlOiBDb2RlcyBleHBpcmUgcXVpY2tseS4gWW91IG1heSBuZWVkIHRvIHJlcXVlc3QgYSBuZXcgY29kZS4iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0cnkgPSBpbnB1dCgiUmVxdWVzdCBuZXcgY29kZT8gKHkvbik6ICIpLnN0cmlwKCkubG93ZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmV0cnkgPT0gJ3knOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLmFwaS5zZW5kX3ZlcmlmaWNhdGlvbl9jb2RlKGRldmljZSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbigiRmFpbGVkIHRvIHNlbmQgbmV3IHZlcmlmaWNhdGlvbiBjb2RlIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiTmV3IHZlcmlmaWNhdGlvbiBjb2RlIHNlbnQiKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJJbnZhbGlkIHZlcmlmaWNhdGlvbiBjb2RlIGFmdGVyIG11bHRpcGxlIGF0dGVtcHRzIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJTdWNjZXNzZnVsbHkgYXV0aGVudGljYXRlZCB3aXRoIGlDbG91ZCIpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBQeWlDbG91ZEZhaWxlZExvZ2luRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbigmIkZhaWxlZCB0byBsb2dpbiB0byBpQ2xvdWQ6IHtlfSIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICByYWlzZSBFeGNlcHRpb24oZiJBdXRoZW50aWNhdGlvbiBlcnJvcjoge2V9IikKICAgIAogICAgZGVmIGNyZWF0ZV9hbGJ1bShzZWxmLCBhbGJ1bV9uYW1lOiBzdHIpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgQ3JlYXRlIGFuIGFsYnVtIGluIGlDbG91ZCBQaG90b3MuCiAgICAgICAgCiAgICAgICAgTm90ZTogcHlpY2xvdWQgbWF5IG5vdCBzdXBwb3J0IGFsYnVtIGNyZWF0aW9uIGRpcmVjdGx5LgogICAgICAgIFRoaXMgaXMgYSBwbGFjZWhvbGRlciBmb3IgZnV0dXJlIGltcGxlbWVudGF0aW9uLgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGFsYnVtX25hbWU6IE5hbWUgb2YgdGhlIGFsYnVtIHRvIGNyZWF0ZQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIFRydWUgaWYgc3VjY2Vzc2Z1bCwgRmFsc2Ugb3RoZXJ3aXNlCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIHB5aWNsb3VkIGRvZXNuJ3QgaGF2ZSBkaXJlY3QgYWxidW0gY3JlYXRpb24gc3VwcG9ydAogICAgICAgICAgICAjIEFsYnVtcyBtYXkgbmVlZCB0byBiZSBjcmVhdGVkIG1hbnVhbGx5IG9yIHRocm91Z2ggUGhvdG9zIGFwcAogICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIkFsYnVtIGNyZWF0aW9uIG5vdCBzdXBwb3J0ZWQgdmlhIEFQSToge2FsYnVtX25hbWV9IikKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkFsYnVtcyB3aWxsIG5lZWQgdG8gYmUgY3JlYXRlZCBtYW51YWxseSBpbiBpQ2xvdWQgUGhvdG9zIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJGYWlsZWQgdG8gY3JlYXRlIGFsYnVtIHthbGJ1bV9uYW1lfToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiB1cGxvYWRfcGhvdG8oc2VsZiwgcGhvdG9fcGF0aDogUGF0aCkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBVcGxvYWQgYSBzaW5nbGUgcGhvdG8gdG8gaUNsb3VkIFBob3Rvcy4KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBwaG90b19wYXRoOiBQYXRoIHRvIHBob3RvIGZpbGUKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBUcnVlIGlmIHN1Y2Nlc3NmdWwsIEZhbHNlIG90aGVyd2lzZQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBweWljbG91ZCdzIHBob3RvIHVwbG9hZCBmdW5jdGlvbmFsaXR5IG1heSBiZSBsaW1pdGVkCiAgICAgICAgICAgICMgVGhlIFBob3RvcyBBUEkgZG9lc24ndCBoYXZlIGEgcHVibGljIHVwbG9hZCBlbmRwb2ludAogICAgICAgICAgICAjIFRoaXMgaXMgYSBwbGFjZWhvbGRlciAtIGFjdHVhbCBpbXBsZW1lbnRhdGlvbiBtYXkgcmVxdWlyZQogICAgICAgICAgICAjIHVzaW5nIFBob3RvcyBhcHAgc3luYyBvciBhbHRlcm5hdGl2ZSBtZXRob2RzCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2dnZXIud2FybmluZygiRGlyZWN0IHBob3RvIHVwbG9hZCB2aWEgcHlpY2xvdWQgbWF5IG5vdCBiZSBzdXBwb3J0ZWQiKQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIldvdWxkIHVwbG9hZDoge3Bob3RvX3BhdGgubmFtZX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBBbHRlcm5hdGl2ZTogVXNlIFBob3RvcyBsaWJyYXJ5IHN5bmMKICAgICAgICAgICAgIyBGaWxlcyB3b3VsZCBuZWVkIHRvIGJlIGNvcGllZCB0byBQaG90b3MgbGlicmFyeSBkaXJlY3RvcnkKICAgICAgICAgICAgIyB3aGljaCB0aGVuIHN5bmNzIHRvIGlDbG91ZAogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiRmFpbGVkIHRvIHVwbG9hZCBwaG90byB7cGhvdG9fcGF0aC5uYW1lfToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiB2ZXJpZnlfZmlsZV91cGxvYWRlZChzZWxmLCBmaWxlX3BhdGg6IFBhdGgpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgVmVyaWZ5IHRoYXQgYSBmaWxlIHdhcyBzdWNjZXNzZnVsbHkgdXBsb2FkZWQgdG8gaUNsb3VkIFBob3Rvcy4KICAgICAgICAKICAgICAgICBOb3RlOiBUaGlzIGlzIGEgcGxhY2Vob2xkZXIgYXMgZGlyZWN0IEFQSSB1cGxvYWQgbWF5IG5vdCBiZSBzdXBwb3J0ZWQuCiAgICAgICAgRm9yIGFjdHVhbCB2ZXJpZmljYXRpb24sIHlvdSBtYXkgbmVlZCB0byBxdWVyeSB0aGUgaUNsb3VkIFBob3RvcyBBUEkuCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgZmlsZV9wYXRoOiBQYXRoIHRvIHRoZSBvcmlnaW5hbCBmaWxlCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgVHJ1ZSBpZiBmaWxlIGlzIHZlcmlmaWVkIHRvIGJlIHVwbG9hZGVkLCBGYWxzZSBvdGhlcndpc2UKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgU2luY2UgZGlyZWN0IEFQSSB1cGxvYWQgbWF5IG5vdCBiZSBzdXBwb3J0ZWQsIHZlcmlmaWNhdGlvbiBpcyBsaW1pdGVkCiAgICAgICAgICAgICMgSW4gYSByZWFsIGltcGxlbWVudGF0aW9uLCB5b3Ugd291bGQgcXVlcnkgdGhlIGlDbG91ZCBQaG90b3MgQVBJCiAgICAgICAgICAgICMgdG8gY2hlY2sgaWYgdGhlIGZpbGUgZXhpc3RzCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEZvciBub3csIGlmIHVwbG9hZF9waG90byByZXR1cm5lZCBUcnVlLCB3ZSBhc3N1bWUgaXQncyB1cGxvYWRlZAogICAgICAgICAgICAjIFRoaXMgaXMgYSBwbGFjZWhvbGRlciAtIGFjdHVhbCB2ZXJpZmljYXRpb24gd291bGQgcmVxdWlyZSBBUEkgcXVlcnkKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiVmVyaWZpY2F0aW9uIG5vdCBmdWxseSBzdXBwb3J0ZWQgZm9yIEFQSSB1cGxvYWRlcjoge2ZpbGVfcGF0aC5uYW1lfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIkVycm9yIHZlcmlmeWluZyBmaWxlIHtmaWxlX3BhdGgubmFtZX06IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgdXBsb2FkX3Bob3Rvc19iYXRjaChzZWxmLCBwaG90b19wYXRoczogTGlzdFtQYXRoXSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsYnVtX25hbWU6IE9wdGlvbmFsW3N0cl0gPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAgICB2ZXJpZnlfYWZ0ZXJfdXBsb2FkOiBib29sID0gVHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgb25fdmVyaWZpY2F0aW9uX2ZhaWx1cmU6IE9wdGlvbmFsW0NhbGxhYmxlW1tQYXRoXSwgTm9uZV1dID0gTm9uZSkgLT4gRGljdFtQYXRoLCBib29sXToKICAgICAgICAiIiIKICAgICAgICBVcGxvYWQgbXVsdGlwbGUgcGhvdG9zIGluIGEgYmF0Y2guCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcGhvdG9fcGF0aHM6IExpc3Qgb2YgcGhvdG8gZmlsZSBwYXRocwogICAgICAgICAgICBhbGJ1bV9uYW1lOiBPcHRpb25hbCBhbGJ1bSBuYW1lIHRvIGFkZCBwaG90b3MgdG8KICAgICAgICAgICAgdmVyaWZ5X2FmdGVyX3VwbG9hZDogSWYgVHJ1ZSwgdmVyaWZ5IGVhY2ggZmlsZSBhZnRlciB1cGxvYWQKICAgICAgICAgICAgb25fdmVyaWZpY2F0aW9uX2ZhaWx1cmU6IE9wdGlvbmFsIGNhbGxiYWNrIGZ1bmN0aW9uKGZpbGVfcGF0aCkgY2FsbGVkIHdoZW4gdmVyaWZpY2F0aW9uIGZhaWxzCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdGlvbmFyeSBtYXBwaW5nIGZpbGUgcGF0aHMgdG8gc3VjY2VzcyBzdGF0dXMKICAgICAgICAiIiIKICAgICAgICByZXN1bHRzID0ge30KICAgICAgICAKICAgICAgICBmb3IgcGhvdG9fcGF0aCBpbiB0cWRtKHBob3RvX3BhdGhzLCBkZXNjPWYiVXBsb2FkaW5nIHBob3RvcyIpOgogICAgICAgICAgICBzdWNjZXNzID0gc2VsZi51cGxvYWRfcGhvdG8ocGhvdG9fcGF0aCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVmVyaWZ5IHVwbG9hZCBpZiByZXF1ZXN0ZWQKICAgICAgICAgICAgaWYgc3VjY2VzcyBhbmQgdmVyaWZ5X2FmdGVyX3VwbG9hZDoKICAgICAgICAgICAgICAgIHZlcmlmaWVkID0gc2VsZi52ZXJpZnlfZmlsZV91cGxvYWRlZChwaG90b19wYXRoKQogICAgICAgICAgICAgICAgaWYgbm90IHZlcmlmaWVkOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiVXBsb2FkIHZlcmlmaWNhdGlvbiBmYWlsZWQgZm9yIHtwaG90b19wYXRoLm5hbWV9IikKICAgICAgICAgICAgICAgICAgICBpZiBvbl92ZXJpZmljYXRpb25fZmFpbHVyZToKICAgICAgICAgICAgICAgICAgICAgICAgb25fdmVyaWZpY2F0aW9uX2ZhaWx1cmUocGhvdG9fcGF0aCkKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIHJlc3VsdHNbcGhvdG9fcGF0aF0gPSBzdWNjZXNzCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFJhdGUgbGltaXRpbmcKICAgICAgICAgICAgdGltZS5zbGVlcCgwLjUpCiAgICAgICAgCiAgICAgICAgc3VjY2Vzc2Z1bCA9IHN1bSgxIGZvciB2IGluIHJlc3VsdHMudmFsdWVzKCkgaWYgdikKICAgICAgICBsb2dnZXIuaW5mbyhmIlVwbG9hZGVkIHtzdWNjZXNzZnVsfS97bGVuKHJlc3VsdHMpfSBwaG90b3MiKQogICAgICAgIAogICAgICAgIHJldHVybiByZXN1bHRzCiAgICAKICAgIGRlZiB1cGxvYWRfdmlkZW8oc2VsZiwgdmlkZW9fcGF0aDogUGF0aCkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBVcGxvYWQgYSBzaW5nbGUgdmlkZW8gdG8gaUNsb3VkIFBob3Rvcy4KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB2aWRlb19wYXRoOiBQYXRoIHRvIHZpZGVvIGZpbGUKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBUcnVlIGlmIHN1Y2Nlc3NmdWwsIEZhbHNlIG90aGVyd2lzZQogICAgICAgICIiIgogICAgICAgICMgU2ltaWxhciB0byBwaG90byB1cGxvYWQgLSBtYXkgbm90IGJlIGRpcmVjdGx5IHN1cHBvcnRlZAogICAgICAgIGxvZ2dlci53YXJuaW5nKGYiVmlkZW8gdXBsb2FkIG1heSBub3QgYmUgc3VwcG9ydGVkOiB7dmlkZW9fcGF0aC5uYW1lfSIpCiAgICAgICAgcmV0dXJuIEZhbHNlCgoKY2xhc3MgaUNsb3VkUGhvdG9zU3luY1VwbG9hZGVyOgogICAgIiIiCiAgICBBbHRlcm5hdGl2ZSB1cGxvYWRlciB1c2luZyBQaG90b3MgbGlicmFyeSBzeW5jIG1ldGhvZC4KICAgIAogICAgVGhpcyBhcHByb2FjaCBjb3BpZXMgZmlsZXMgdG8gdGhlIFBob3RvcyBsaWJyYXJ5IGRpcmVjdG9yeSwKICAgIHdoaWNoIHRoZW4gc3luY3MgdG8gaUNsb3VkIFBob3RvcyBhdXRvbWF0aWNhbGx5LgogICAgIiIiCiAgICAKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBwaG90b3NfbGlicmFyeV9wYXRoOiBPcHRpb25hbFtQYXRoXSA9IE5vbmUpOgogICAgICAgICIiIgogICAgICAgIEluaXRpYWxpemUgdGhlIHN5bmMtYmFzZWQgdXBsb2FkZXIuCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcGhvdG9zX2xpYnJhcnlfcGF0aDogUGF0aCB0byBQaG90b3MgbGlicmFyeSAoZGVmYXVsdHMgdG8gbWFjT1MgZGVmYXVsdCkKICAgICAgICAiIiIKICAgICAgICBpZiBwaG90b3NfbGlicmFyeV9wYXRoIGlzIE5vbmU6CiAgICAgICAgICAgICMgRGVmYXVsdCBtYWNPUyBQaG90b3MgbGlicmFyeSBsb2NhdGlvbgogICAgICAgICAgICBob21lID0gUGF0aC5ob21lKCkKICAgICAgICAgICAgc2VsZi5waG90b3NfbGlicmFyeV9wYXRoID0gaG9tZSAvICJQaWN0dXJlcyIgLyAiUGhvdG9zIExpYnJhcnkucGhvdG9zbGlicmFyeSIKICAgICAgICBlbHNlOgogICAgICAgICAgICBzZWxmLnBob3Rvc19saWJyYXJ5X3BhdGggPSBwaG90b3NfbGlicmFyeV9wYXRoCiAgICAgICAgCiAgICAgICAgIyBQaG90b3MgbGlicmFyeSBzdHJ1Y3R1cmUKICAgICAgICBzZWxmLm1hc3RlcnNfcGF0aCA9IHNlbGYucGhvdG9zX2xpYnJhcnlfcGF0aCAvICJNYXN0ZXJzIgogICAgICAgIAogICAgICAgIGxvZ2dlci5pbmZvKGYiVXNpbmcgUGhvdG9zIGxpYnJhcnk6IHtzZWxmLnBob3Rvc19saWJyYXJ5X3BhdGh9IikKICAgIAogICAgZGVmIHVwbG9hZF9maWxlKHNlbGYsIGZpbGVfcGF0aDogUGF0aCwgYWxidW1fbmFtZTogT3B0aW9uYWxbc3RyXSA9IE5vbmUpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgQ29weSBmaWxlIHRvIFBob3RvcyBsaWJyYXJ5IGZvciBzeW5jLgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGZpbGVfcGF0aDogUGF0aCB0byBtZWRpYSBmaWxlCiAgICAgICAgICAgIGFsYnVtX25hbWU6IE9wdGlvbmFsIGFsYnVtIG5hbWUgKG5vdCBkaXJlY3RseSBzdXBwb3J0ZWQpCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgVHJ1ZSBpZiBzdWNjZXNzZnVsLCBGYWxzZSBvdGhlcndpc2UKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgQ3JlYXRlIE1hc3RlcnMgZGlyZWN0b3J5IGlmIGl0IGRvZXNuJ3QgZXhpc3QKICAgICAgICAgICAgc2VsZi5tYXN0ZXJzX3BhdGgubWtkaXIocGFyZW50cz1UcnVlLCBleGlzdF9vaz1UcnVlKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBPcmdhbml6ZSBieSBkYXRlICh5ZWFyL21vbnRoKQogICAgICAgICAgICAjIFRoaXMgaGVscHMgUGhvdG9zIGFwcCBvcmdhbml6ZSBmaWxlcwogICAgICAgICAgICBpbXBvcnQgc2h1dGlsCiAgICAgICAgICAgIGZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRyeSB0byBnZXQgZGF0ZSBmcm9tIGZpbGUgbWV0YWRhdGEKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZnJvbSBQSUwgaW1wb3J0IEltYWdlCiAgICAgICAgICAgICAgICBmcm9tIFBJTC5FeGlmVGFncyBpbXBvcnQgREFURVRJTUUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaW1nID0gSW1hZ2Uub3BlbihmaWxlX3BhdGgpCiAgICAgICAgICAgICAgICBleGlmID0gaW1nLl9nZXRleGlmKCkKICAgICAgICAgICAgICAgIGlmIGV4aWY6CiAgICAgICAgICAgICAgICAgICAgZGF0ZV9zdHIgPSBleGlmLmdldChEQVRFVElNRSkKICAgICAgICAgICAgICAgICAgICBpZiBkYXRlX3N0cjoKICAgICAgICAgICAgICAgICAgICAgICAgZHQgPSBkYXRldGltZS5zdHJwdGltZShkYXRlX3N0ciwgIiVZOiVtOiVkICVIOiVNOiVTIikKICAgICAgICAgICAgICAgICAgICAgICAgeWVhciA9IGR0LnllYXIKICAgICAgICAgICAgICAgICAgICAgICAgbW9udGggPSBkdC5tb250aAogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHllYXIgPSBkYXRldGltZS5ub3coKS55ZWFyCiAgICAgICAgICAgICAgICAgICAgICAgIG1vbnRoID0gZGF0ZXRpbWUubm93KCkubW9udGgKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgeWVhciA9IGRhdGV0aW1lLm5vdygpLnllYXIKICAgICAgICAgICAgICAgICAgICBtb250aCA9IGRhdGV0aW1lLm5vdygpLm1vbnRoCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHllYXIgPSBkYXRldGltZS5ub3coKS55ZWFyCiAgICAgICAgICAgICAgICBtb250aCA9IGRhdGV0aW1lLm5vdygpLm1vbnRoCiAgICAgICAgICAgIAogICAgICAgICAgICAjIENyZWF0ZSB5ZWFyL21vbnRoIGRpcmVjdG9yeQogICAgICAgICAgICB0YXJnZXRfZGlyID0gc2VsZi5tYXN0ZXJzX3BhdGggLyBzdHIoeWVhcikgLyBmInttb250aDowMmR9IgogICAgICAgICAgICB0YXJnZXRfZGlyLm1rZGlyKHBhcmVudHM9VHJ1ZSwgZXhpc3Rfb2s9VHJ1ZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ29weSBmaWxlCiAgICAgICAgICAgIHRhcmdldF9wYXRoID0gdGFyZ2V0X2RpciAvIGZpbGVfcGF0aC5uYW1lCiAgICAgICAgICAgIHNodXRpbC5jb3B5MihmaWxlX3BhdGgsIHRhcmdldF9wYXRoKQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiQ29waWVkIHtmaWxlX3BhdGgubmFtZX0gdG8gUGhvdG9zIGxpYnJhcnkiKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkZhaWxlZCB0byBjb3B5IHtmaWxlX3BhdGgubmFtZX06IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgdmVyaWZ5X2ZpbGVfdXBsb2FkZWQoc2VsZiwgZmlsZV9wYXRoOiBQYXRoKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFZlcmlmeSB0aGF0IGEgZmlsZSB3YXMgc3VjY2Vzc2Z1bGx5IHVwbG9hZGVkIHRvIGlDbG91ZCBQaG90b3MuCiAgICAgICAgCiAgICAgICAgRm9yIHN5bmMgbWV0aG9kLCB0aGlzIGNoZWNrcyBpZiB0aGUgZmlsZSBleGlzdHMgaW4gdGhlIFBob3RvcyBsaWJyYXJ5LgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGZpbGVfcGF0aDogUGF0aCB0byB0aGUgb3JpZ2luYWwgZmlsZQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIFRydWUgaWYgZmlsZSBpcyB2ZXJpZmllZCB0byBiZSB1cGxvYWRlZCwgRmFsc2Ugb3RoZXJ3aXNlCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUcnkgdG8gZ2V0IGRhdGUgZnJvbSBmaWxlIG1ldGFkYXRhIHRvIGZpbmQgdGFyZ2V0IGxvY2F0aW9uCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGZyb20gUElMIGltcG9ydCBJbWFnZQogICAgICAgICAgICAgICAgZnJvbSBQSUwuRXhpZlRhZ3MgaW1wb3J0IERBVEVUSU1FCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGltZyA9IEltYWdlLm9wZW4oZmlsZV9wYXRoKQogICAgICAgICAgICAgICAgZXhpZiA9IGltZy5fZ2V0ZXhpZigpCiAgICAgICAgICAgICAgICBpZiBleGlmOgogICAgICAgICAgICAgICAgICAgIGRhdGVfc3RyID0gZXhpZi5nZXQoREFURVRJTUUpCiAgICAgICAgICAgICAgICAgICAgaWYgZGF0ZV9zdHI6CiAgICAgICAgICAgICAgICAgICAgICAgIGR0ID0gZGF0ZXRpbWUuc3RycHRpbWUoZGF0ZV9zdHIsICIlWTolbTolZCAlSDolTTolUyIpCiAgICAgICAgICAgICAgICAgICAgICAgIHllYXIgPSBkdC55ZWFyCiAgICAgICAgICAgICAgICAgICAgICAgIG1vbnRoID0gZHQubW9udGgKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICB5ZWFyID0gZGF0ZXRpbWUubm93KCkueWVhcgogICAgICAgICAgICAgICAgICAgICAgICBtb250aCA9IGRhdGV0aW1lLm5vdygpLm1vbnRoCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHllYXIgPSBkYXRldGltZS5ub3coKS55ZWFyCiAgICAgICAgICAgICAgICAgICAgbW9udGggPSBkYXRldGltZS5ub3coKS5tb250aAogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICB5ZWFyID0gZGF0ZXRpbWUubm93KCkueWVhcgogICAgICAgICAgICAgICAgbW9udGggPSBkYXRldGltZS5ub3coKS5tb250aAogICAgICAgICAgICAKICAgICAgICAgICAgIyBDaGVjayBpZiBmaWxlIGV4aXN0cyBpbiBQaG90b3MgbGlicmFyeQogICAgICAgICAgICB0YXJnZXRfZGlyID0gc2VsZi5tYXN0ZXJzX3BhdGggLyBzdHIoeWVhcikgLyBmInttb250aDowMmR9IgogICAgICAgICAgICB0YXJnZXRfcGF0aCA9IHRhcmdldF9kaXIgLyBmaWxlX3BhdGgubmFtZQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgdGFyZ2V0X3BhdGguZXhpc3RzKCk6CiAgICAgICAgICAgICAgICAjIEFsc28gdmVyaWZ5IGZpbGUgc2l6ZSBtYXRjaGVzIChiYXNpYyBpbnRlZ3JpdHkgY2hlY2spCiAgICAgICAgICAgICAgICBpZiB0YXJnZXRfcGF0aC5zdGF0KCkuc3Rfc2l6ZSA9PSBmaWxlX3BhdGguc3RhdCgpLnN0X3NpemU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIkVycm9yIHZlcmlmeWluZyBmaWxlIHtmaWxlX3BhdGgubmFtZX06IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgdXBsb2FkX2ZpbGVzX2JhdGNoKHNlbGYsIGZpbGVfcGF0aHM6IExpc3RbUGF0aF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgYWxidW1zOiBPcHRpb25hbFtEaWN0W1BhdGgsIHN0cl1dID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICB2ZXJpZnlfYWZ0ZXJfdXBsb2FkOiBib29sID0gVHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICBvbl92ZXJpZmljYXRpb25fZmFpbHVyZTogT3B0aW9uYWxbQ2FsbGFibGVbW1BhdGhdLCBOb25lXV0gPSBOb25lKSAtPiBEaWN0W1BhdGgsIGJvb2xdOgogICAgICAgICIiIgogICAgICAgIFVwbG9hZCBtdWx0aXBsZSBmaWxlcyBpbiBhIGJhdGNoLgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGZpbGVfcGF0aHM6IExpc3Qgb2YgZmlsZSBwYXRocwogICAgICAgICAgICBhbGJ1bXM6IE9wdGlvbmFsIG1hcHBpbmcgb2YgZmlsZXMgdG8gYWxidW0gbmFtZXMKICAgICAgICAgICAgdmVyaWZ5X2FmdGVyX3VwbG9hZDogSWYgVHJ1ZSwgdmVyaWZ5IGVhY2ggZmlsZSBhZnRlciB1cGxvYWQKICAgICAgICAgICAgb25fdmVyaWZpY2F0aW9uX2ZhaWx1cmU6IE9wdGlvbmFsIGNhbGxiYWNrIGZ1bmN0aW9uKGZpbGVfcGF0aCkgY2FsbGVkIHdoZW4gdmVyaWZpY2F0aW9uIGZhaWxzCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgRGljdGlvbmFyeSBtYXBwaW5nIGZpbGUgcGF0aHMgdG8gc3VjY2VzcyBzdGF0dXMKICAgICAgICAiIiIKICAgICAgICByZXN1bHRzID0ge30KICAgICAgICAKICAgICAgICBmb3IgZmlsZV9wYXRoIGluIHRxZG0oZmlsZV9wYXRocywgZGVzYz0iQ29weWluZyB0byBQaG90b3MgbGlicmFyeSIpOgogICAgICAgICAgICBhbGJ1bV9uYW1lID0gYWxidW1zLmdldChmaWxlX3BhdGgpIGlmIGFsYnVtcyBlbHNlIE5vbmUKICAgICAgICAgICAgc3VjY2VzcyA9IHNlbGYudXBsb2FkX2ZpbGUoZmlsZV9wYXRoLCBhbGJ1bV9uYW1lKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBWZXJpZnkgdXBsb2FkIGlmIHJlcXVlc3RlZAogICAgICAgICAgICBpZiBzdWNjZXNzIGFuZCB2ZXJpZnlfYWZ0ZXJfdXBsb2FkOgogICAgICAgICAgICAgICAgdmVyaWZpZWQgPSBzZWxmLnZlcmlmeV9maWxlX3VwbG9hZGVkKGZpbGVfcGF0aCkKICAgICAgICAgICAgICAgIGlmIG5vdCB2ZXJpZmllZDoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIlVwbG9hZCB2ZXJpZmljYXRpb24gZmFpbGVkIGZvciB7ZmlsZV9wYXRoLm5hbWV9IikKICAgICAgICAgICAgICAgICAgICBpZiBvbl92ZXJpZmljYXRpb25fZmFpbHVyZToKICAgICAgICAgICAgICAgICAgICAgICAgb25fdmVyaWZpY2F0aW9uX2ZhaWx1cmUoZmlsZV9wYXRoKQogICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgcmVzdWx0c1tmaWxlX3BhdGhdID0gc3VjY2VzcwogICAgICAgIAogICAgICAgIHN1Y2Nlc3NmdWwgPSBzdW0oMSBmb3IgdiBpbiByZXN1bHRzLnZhbHVlcygpIGlmIHYpCiAgICAgICAgbG9nZ2VyLmluZm8oZiJDb3BpZWQge3N1Y2Nlc3NmdWx9L3tsZW4ocmVzdWx0cyl9IGZpbGVzIHRvIFBob3RvcyBsaWJyYXJ5IikKICAgICAgICAKICAgICAgICByZXR1cm4gcmVzdWx0cwoK'''

# Decode and write the file
content = base64.b64decode(encoded_content)
with open('icloud_uploader.py', 'wb') as f:
    f.write(content)
print('âœ“ File icloud_uploader.py created successfully!')
print(f'File size: {len(content)} bytes')

