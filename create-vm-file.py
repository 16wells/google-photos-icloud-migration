#!/usr/bin/env python3
"""
Script to create icloud_uploader.py on VM
Run this in Browser SSH on the VM, then paste the output
"""

import base64

# Base64 encoded file content
ENCODED_CONTENT = """IiIiClVwbG9hZCBtZWRpYSBmaWxlcyB0byBpQ2xvdWQgUGhvdG9zIHVzaW5nIHB5aWNsb3VkIGxpYnJhcnkuCiIiIgppbXBvcnQgbG9nZ2luZwppbXBvcnQgdGltZQpmcm9tIHBhdGhsaWIgaW1wb3J0IFBhdGgKZnJvbSB0eXBpbmcgaW1wb3J0IExpc3QsIERpY3QsIE9wdGlvbmFsLCBDYWxsYWJsZQpmcm9tIHB5aWNsb3VkIGltcG9ydCBQeWlDbG91ZFNlcnZpY2UKZnJvbSBweWljbG91ZC5leGNlcHRpb25zIGltcG9ydCBQeWlDbG91ZEZhaWxlZExvZ2luRXhjZXB0aW9uLCBQeWlDbG91ZDJTQVJlcXVpcmVkRXhjZXB0aW9uCmZyb20gdHFkbSBpbXBvcnQgdHFkbQoKbG9nZ2VyID0gbG9nZ2luZy5nZXRMb2dnZXIoX19uYW1lX18pCgoKY2xhc3MgaUNsb3VkVXBsb2FkZXI6CiAgICAiIiJIYW5kbGVzIHVwbG9hZGluZyBtZWRpYSBmaWxlcyB0byBpQ2xvdWQgUGhvdG9zLiIiIgogICAgCiAgICBkZWYgX19pbml0X18oc2VsZiwgYXBwbGVfaWQ6IHN0ciwgcGFzc3dvcmQ6IHN0ciwgCiAgICAgICAgICAgICAgICAgdHJ1c3RlZF9kZXZpY2VfaWQ6IE9wdGlvbmFsW3N0cl0gPSBOb25lKToKICAgICAgICAiIiIKICAgICAgICBJbml0aWFsaXplIHRoZSBpQ2xvdWQgdXBsb2FkZXIuCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYXBwbGVfaWQ6IEFwcGxlIElEIGVtYWlsCiAgICAgICAgICAgIHBhc3N3b3JkOiBBcHBsZSBJRCBwYXNzd29yZCAoZW1wdHkgc3RyaW5nIHdpbGwgcHJvbXB0KQogICAgICAgICAgICB0cnVzdGVkX2RldmljZV9pZDogT3B0aW9uYWwgdHJ1c3RlZCBkZXZpY2UgSUQgZm9yIDJGQQogICAgICAgICIiIgogICAgICAgIHNlbGYuYXBwbGVfaWQgPSBhcHBsZV9pZAogICAgICAgIHNlbGYucGFzc3dvcmQgPSBwYXNzd29yZC5zdHJpcCgpIGlmIHBhc3N3b3JkIGVsc2UgJycKICAgICAgICBzZWxmLnRydXN0ZWRfZGV2aWNlX2lkID0gdHJ1c3RlZF9kZXZpY2VfaWQKICAgICAgICBzZWxmLmFwaSA9IE5vbmUKICAgICAgICAKICAgICAgICAjIFByb21wdCBmb3IgcGFzc3dvcmQgaWYgZW1wdHkKICAgICAgICBpZiBub3Qgc2VsZi5wYXNzd29yZDoKICAgICAgICAgICAgaW1wb3J0IGdldHBhc3MKICAgICAgICAgICAgbG9nZ2VyLmluZm8oImlDbG91ZCBwYXNzd29yZCBub3QgcHJvdmlkZWQuIFBsZWFzZSBlbnRlciB5b3VyIEFwcGxlIElEIHBhc3N3b3JkOiIpCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCIoTm90ZTogSWYgeW91IGhhdmUgMkZBIGVuYWJsZWQsIHVzZSB5b3VyIHJlZ3VsYXIgcGFzc3dvcmQpIikKICAgICAgICAgICAgc2VsZi5wYXNzd29yZCA9IGdldHBhc3MuZ2V0cGFzcygiUGFzc3dvcmQ6ICIpCiAgICAgICAgCiAgICAgICAgc2VsZi5fYXV0aGVudGljYXRlKCkKICAgIAogICAgZGVmIF9hdXRoZW50aWNhdGUoc2VsZik6CiAgICAgICAgIiIiQXV0aGVudGljYXRlIHdpdGggaUNsb3VkLiIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5hcGkgPSBQeWlDbG91ZFNlcnZpY2Uoc2VsZi5hcHBsZV9pZCwgc2VsZi5wYXNzd29yZCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgSGFuZGxlIDJGQSBpZiByZXF1aXJlZAogICAgICAgICAgICBpZiBzZWxmLmFwaS5yZXF1aXJlc18yZmE6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiVHdvLWZhY3RvciBhdXRoZW50aWNhdGlvbiByZXF1aXJlZCIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHNlbGYudHJ1c3RlZF9kZXZpY2VfaWQ6CiAgICAgICAgICAgICAgICAgICAgIyBVc2UgdHJ1c3RlZCBkZXZpY2UKICAgICAgICAgICAgICAgICAgICBkZXZpY2VzID0gc2VsZi5hcGkudHJ1c3RlZF9kZXZpY2VzCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBFbnN1cmUgZGV2aWNlcyBpcyBhIGxpc3QKICAgICAgICAgICAgICAgICAgICBpZiBkZXZpY2VzIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZXMgPSBbXQogICAgICAgICAgICAgICAgICAgIGVsaWYgbm90IGlzaW5zdGFuY2UoZGV2aWNlcywgbGlzdCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZXMgPSBsaXN0KGRldmljZXMpIGlmIGhhc2F0dHIoZGV2aWNlcywgJ19faXRlcl9fJykgZWxzZSBbXQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIGxlbihkZXZpY2VzKSA9PSAwOgogICAgICAgICAgICAgICAgICAgICAgICByYWlzZSBFeGNlcHRpb24oIk5vIHRydXN0ZWQgZGV2aWNlcyBmb3VuZC4gUGxlYXNlIHNldCB1cCB0cnVzdGVkIGRldmljZXMgaW4geW91ciBBcHBsZSBJRCBzZXR0aW5ncy4iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlX2lkeCA9IGludChzZWxmLnRydXN0ZWRfZGV2aWNlX2lkKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBkZXZpY2VfaWR4IDwgMCBvciBkZXZpY2VfaWR4ID49IGxlbihkZXZpY2VzKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbigiSW52YWxpZCB0cnVzdGVkX2RldmljZV9pZDogezB9LiBWYWxpZCByYW5nZTogMC17MX0iLmZvcm1hdChzZWxmLnRydXN0ZWRfZGV2aWNlX2lkLCBsZW4oZGV2aWNlcyktMSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZSA9IGRldmljZXNbZGV2aWNlX2lkeF0KICAgICAgICAgICAgICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJJbnZhbGlkIHRydXN0ZWRfZGV2aWNlX2lkIGZvcm1hdDogezB9LiBNdXN0IGJlIGEgbnVtYmVyLiIuZm9ybWF0KHNlbGYudHJ1c3RlZF9kZXZpY2VfaWQpKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGRldmljZV9uYW1lID0gZGV2aWNlLmdldCgnZGV2aWNlTmFtZScsICdVbmtub3duJykKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiVXNpbmcgdHJ1c3RlZCBkZXZpY2U6IHswfSIuZm9ybWF0KGRldmljZV9uYW1lKSkKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5hcGkuc2VuZF92ZXJpZmljYXRpb25fY29kZShkZXZpY2UpOgogICAgICAgICAgICAgICAgICAgICAgICByYWlzZSBFeGNlcHRpb24oIkZhaWxlZCB0byBzZW5kIHZlcmlmaWNhdGlvbiBjb2RlIikKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiVmVyaWZpY2F0aW9uIGNvZGUgc2VudCB0byB7MH0iLmZvcm1hdChkZXZpY2VfbmFtZSkpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICMgTGlzdCBhdmFpbGFibGUgZGV2aWNlcwogICAgICAgICAgICAgICAgICAgIGRldmljZXMgPSBzZWxmLmFwaS50cnVzdGVkX2RldmljZXMKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEVuc3VyZSBkZXZpY2VzIGlzIGEgbGlzdAogICAgICAgICAgICAgICAgICAgIGlmIGRldmljZXMgaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlcyA9IFtdCiAgICAgICAgICAgICAgICAgICAgZWxpZiBub3QgaXNpbnN0YW5jZShkZXZpY2VzLCBsaXN0KToKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlcyA9IGxpc3QoZGV2aWNlcykgaWYgaGFzYXR0cihkZXZpY2VzLCAnX19pdGVyX18nKSBlbHNlIFtdCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBDaGVjayBpZiBkZXZpY2VzIGxpc3QgaXMgZW1wdHkKICAgICAgICAgICAgICAgICAgICBpZiBsZW4oZGV2aWNlcykgPT0gMDoKICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJObyB0cnVzdGVkIGRldmljZXMgZm91bmQuIFBsZWFzZSBzZXQgdXAgdHJ1c3RlZCBkZXZpY2VzIGluIHlvdXIgQXBwbGUgSUQgc2V0dGluZ3Mgb3IgdXNlIGEgZGlmZmVyZW50IGF1dGhlbnRpY2F0aW9uIG1ldGhvZC4iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJBdmFpbGFibGUgdHJ1c3RlZCBkZXZpY2VzOiIpCiAgICAgICAgICAgICAgICAgICAgZm9yIGksIGRldmljZSBpbiBlbnVtZXJhdGUoZGV2aWNlcyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZV9uYW1lID0gZGV2aWNlLmdldCgnZGV2aWNlTmFtZScsICdVbmtub3duJykKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlX3R5cGUgPSBkZXZpY2UuZ2V0KCdkZXZpY2VUeXBlJywgJ1Vua25vd24nKQogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiIHswfTogezF9ICh7Mn0pIi5mb3JtYXQoaSwgZGV2aWNlX25hbWUsIGRldmljZV90eXBlKSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEdldCBhbmQgdmFsaWRhdGUgZGV2aWNlIHNlbGVjdGlvbgogICAgICAgICAgICAgICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZV9pbmRleCA9IGlucHV0KCJTZWxlY3QgZGV2aWNlIChlbnRlciBudW1iZXIgMC17MH0pOiAiLmZvcm1hdChsZW4oZGV2aWNlcyktMSkpLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWR4ID0gaW50KGRldmljZV9pbmRleCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIDAgPD0gaWR4IDwgbGVuKGRldmljZXMpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZSA9IGRldmljZXNbaWR4XQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJJbnZhbGlkIHNlbGVjdGlvbi4gUGxlYXNlIGVudGVyIGEgbnVtYmVyIGJldHdlZW4gMCBhbmQgezB9Ii5mb3JtYXQobGVuKGRldmljZXMpLTEpKQogICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiSW52YWxpZCBpbnB1dC4gUGxlYXNlIGVudGVyIGEgbnVtYmVyLiIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlX25hbWUgPSBkZXZpY2UuZ2V0KCdkZXZpY2VOYW1lJywgJ1Vua25vd24nKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLmFwaS5zZW5kX3ZlcmlmaWNhdGlvbl9jb2RlKGRldmljZSk6CiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbigiRmFpbGVkIHRvIHNlbmQgdmVyaWZpY2F0aW9uIGNvZGUiKQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJWZXJpZmljYXRpb24gY29kZSBzZW50IHRvIHswfSIuZm9ybWF0KGRldmljZV9uYW1lKSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBBbGxvdyByZXRyaWVzIGZvciAyRkEgY29kZQogICAgICAgICAgICAgICAgbWF4X2F0dGVtcHRzID0gMwogICAgICAgICAgICAgICAgZm9yIGF0dGVtcHQgaW4gcmFuZ2UobWF4X2F0dGVtcHRzKToKICAgICAgICAgICAgICAgICAgICBjb2RlID0gaW5wdXQoIkVudGVyIDJGQSBjb2RlIChhdHRlbXB0IHswfS97MX0pOiAiLmZvcm1hdChhdHRlbXB0KzEsIG1heF9hdHRlbXB0cykpLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAjIFJlbW92ZSBhbnkgc3BhY2VzIG9yIGRhc2hlcyBmcm9tIHRoZSBjb2RlCiAgICAgICAgICAgICAgICAgICAgY29kZSA9IGNvZGUucmVwbGFjZSgnICcsICcnKS5yZXBsYWNlKCctJywgJycpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5hcGkudmFsaWRhdGVfdmVyaWZpY2F0aW9uX2NvZGUoZGV2aWNlLCBjb2RlKToKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIuKckyBWZXJpZmljYXRpb24gY29kZSBhY2NlcHRlZCIpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgYXR0ZW1wdCA8IG1heF9hdHRlbXB0cyAtIDE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiSW52YWxpZCB2ZXJpZmljYXRpb24gY29kZS4gUGxlYXNlIHRyeSBhZ2Fpbi4iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIk5vdGU6IENvZGVzIGV4cGlyZSBxdWlja2x5LiBZb3UgbWF5IG5lZWQgdG8gcmVxdWVzdCBhIG5ldyBjb2RlLiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRyeSA9IGlucHV0KCJSZXF1ZXN0IG5ldyBjb2RlPyAoeS9uKTogIikuc3RyaXAoKS5sb3dlcigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByZXRyeSA9PSAneSc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuYXBpLnNlbmRfdmVyaWZpY2F0aW9uX2NvZGUoZGV2aWNlKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJGYWlsZWQgdG8gc2VuZCBuZXcgdmVyaWZpY2F0aW9uIGNvZGUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJOZXcgdmVyaWZpY2F0aW9uIGNvZGUgc2VudCIpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYWlzZSBFeGNlcHRpb24oIkludmFsaWQgdmVyaWZpY2F0aW9uIGNvZGUgYWZ0ZXIgbXVsdGlwbGUgYXR0ZW1wdHMiKQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIlN1Y2Nlc3NmdWxseSBhdXRoZW50aWNhdGVkIHdpdGggaUNsb3VkIikKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IFB5aUNsb3VkRmFpbGVkTG9naW5FeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJGYWlsZWQgdG8gbG9naW4gdG8gaUNsb3VkOiB7MH0iLmZvcm1hdChlKSkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbigiQXV0aGVudGljYXRpb24gZXJyb3I6IHswfSIuZm9ybWF0KGUpKQogICAgCiAgICBkZWYgY3JlYXRlX2FsYnVtKHNlbGYsIGFsYnVtX25hbWU6IHN0cikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBDcmVhdGUgYW4gYWxidW0gaW4gaUNsb3VkIFBob3Rvcy4KICAgICAgICAKICAgICAgICBOb3RlOiBweWljbG91ZCBtYXkgbm90IHN1cHBvcnQgYWxidW0gY3JlYXRpb24gZGlyZWN0bHkuCiAgICAgICAgVGhpcyBpcyBhIHBsYWNlaG9sZGVyIGZvciBmdXR1cmUgaW1wbGVtZW50YXRpb24uCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgYWxidW1fbmFtZTogTmFtZSBvZiB0aGUgYWxidW0gdG8gY3JlYXRlCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgVHJ1ZSBpZiBzdWNjZXNzZnVsLCBGYWxzZSBvdGhlcndpc2UKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgcHlpY2xvdWQgZG9lc24ndCBoYXZlIGRpcmVjdCBhbGJ1bSBjcmVhdGlvbiBzdXBwb3J0CiAgICAgICAgICAgICMgQWxidW1zIG1heSBuZWVkIHRvIGJlIGNyZWF0ZWQgbWFudWFsbHkgb3IgdGhyb3VnaCBQaG90b3MgYXBwCiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJBbGJ1bSBjcmVhdGlvbiBub3Qgc3VwcG9ydGVkIHZpYSBBUEk6IHswfSIuZm9ybWF0KGFsYnVtX25hbWUpKQogICAgICAgICAgICBsb2dnZXIuaW5mbygiQWxidW1zIHdpbGwgbmVlZCB0byBiZSBjcmVhdGVkIG1hbnVhbGx5IGluIGlDbG91ZCBQaG90b3MiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiRmFpbGVkIHRvIGNyZWF0ZSBhbGJ1bSB7MH06IHsxfSIuZm9ybWF0KGFsYnVtX25hbWUsIGUpKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIHVwbG9hZF9waG90byhzZWxmLCBwaG90b19wYXRoOiBQYXRoKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFVwbG9hZCBhIHNpbmdsZSBwaG90byB0byBpQ2xvdWQgUGhvdG9zLgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHBob3RvX3BhdGg6IFBhdGggdG8gcGhvdG8gZmlsZQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIFRydWUgaWYgc3VjY2Vzc2Z1bCwgRmFsc2Ugb3RoZXJ3aXNlCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIHB5aWNsb3VkJ3MgcGhvdG8gdXBsb2FkIGZ1bmN0aW9uYWxpdHkgbWF5IGJlIGxpbWl0ZWQKICAgICAgICAgICAgIyBUaGUgUGhvdG9zIEFQSSBkb2Vzbid0IGhhdmUgYSBwdWJsaWMgdXBsb2FkIGVuZHBvaW50CiAgICAgICAgICAgICMgVGhpcyBpcyBhIHBsYWNlaG9sZGVyIC0gYWN0dWFsIGltcGxlbWVudGF0aW9uIG1heSByZXF1aXJlCiAgICAgICAgICAgICMgdXNpbmcgUGhvdG9zIGFwcCBzeW5jIG9yIGFsdGVybmF0aXZlIG1ldGhvZHMKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJEaXJlY3QgcGhvdG8gdXBsb2FkIHZpYSBweWljbG91ZCBtYXkgbm90IGJlIHN1cHBvcnRlZCIpCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJXb3VsZCB1cGxvYWQ6IHswfSIuZm9ybWF0KHBob3RvX3BhdGgubmFtZSkpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEFsdGVybmF0aXZlOiBVc2UgUGhvdG9zIGxpYnJhcnkgc3luYwogICAgICAgICAgICAjIEZpbGVzIHdvdWxkIG5lZWQgdG8gYmUgY29waWVkIHRvIFBob3RvcyBsaWJyYXJ5IGRpcmVjdG9yeQogICAgICAgICAgICAjIHdoaWNoIHRoZW4gc3luY3MgdG8gaUNsb3VkCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkZhaWxlZCB0byB1cGxvYWQgcGhvdG8gezB9OiB7MX0iLmZvcm1hdChwaG90b19wYXRoLm5hbWUsIGUpKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIHZlcmlmeV9maWxlX3VwbG9hZGVkKHNlbGYsIGZpbGVfcGF0aDogUGF0aCkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBWZXJpZnkgdGhhdCBhIGZpbGUgd2FzIHN1Y2Nlc3NmdWxseSB1cGxvYWRlZCB0byBpQ2xvdWQgUGhvdG9zLgogICAgICAgIAogICAgICAgIE5vdGU6IFRoaXMgaXMgYSBwbGFjZWhvbGRlciBhcyBkaXJlY3QgQVBJIHVwbG9hZCBtYXkgbm90IGJlIHN1cHBvcnRlZC4KICAgICAgICBGb3IgYWN0dWFsIHZlcmlmaWNhdGlvbiwgeW91IG1heSBuZWVkIHRvIHF1ZXJ5IHRoZSBpQ2xvdWQgUGhvdG9zIEFQSS4KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBmaWxlX3BhdGg6IFBhdGggdG8gdGhlIG9yaWdpbmFsIGZpbGUKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBUcnVlIGlmIGZpbGUgaXMgdmVyaWZpZWQgdG8gYmUgdXBsb2FkZWQsIEZhbHNlIG90aGVyd2lzZQogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBTaW5jZSBkaXJlY3QgQVBJIHVwbG9hZCBtYXkgbm90IGJlIHN1cHBvcnRlZCwgdmVyaWZpY2F0aW9uIGlzIGxpbWl0ZWQKICAgICAgICAgICAgIyBJbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHlvdSB3b3VsZCBxdWVyeSB0aGUgaUNsb3VkIFBob3RvcyBBUEkKICAgICAgICAgICAgIyB0byBjaGVjayBpZiB0aGUgZmlsZSBleGlzdHMKICAgICAgICAgICAgCiAgICAgICAgICAgICMgRm9yIG5vdywgaWYgdXBsb2FkX3Bob3RvIHJldHVybmVkIFRydWUsIHdlIGFzc3VtZSBpdCdzIHVwbG9hZGVkCiAgICAgICAgICAgICMgVGhpcyBpcyBhIHBsYWNlaG9sZGVyIC0gYWN0dWFsIHZlcmlmaWNhdGlvbiB3b3VsZCB3cmVxdWlyZSBBUEkgcXVlcnkKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJWZXJpZmljYXRpb24gbm90IGZ1bGx5IHN1cHBvcnRlZCBmb3IgQVBJIHVwbG9hZGVyOiB7MH0iLmZvcm1hdChmaWxlX3BhdGgubmFtZSkpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiRXJyb3IgdmVyaWZ5aW5nIGZpbGUgezB9OiB7MX0iLmZvcm1hdChmaWxlX3BhdGgubmFtZSwgZSkpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgdXBsb2FkX3Bob3Rvc19iYXRjaChzZWxmLCBwaG90b19wYXRoczogTGlzdFtQYXRoXSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsYnVtX25hbWU6IE9wdGlvbmFsW3N0cl0gPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyaWZ5X2FmdGVyX3VwbG9hZDogYm9vbCA9IFRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uX3ZlcmlmaWNhdGlvbl9mYWlsdXJlOiBPcHRpb25hbFtDYWxsYWJsZVtbUGF0aF0sIE5vbmVdXSA9IE5vbmUpIC0+IERpY3RbUGF0aCwgYm9vbF06CiAgICAgICAgIiIiCiAgICAgICAgVXBsb2FkIG11bHRpcGxlIHBob3RvcyBpbiBhIGJhdGNoLgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHBob3RvX3BhdGhzOiBMaXN0IG9mIHBob3RvIGZpbGUgcGF0aHMKICAgICAgICAgICAgYWxidW1fbmFtZTogT3B0aW9uYWwgYWxidW0gbmFtZSB0byBhZGQgcGhvdG9zIHRvCiAgICAgICAgICAgIHZlcmlmeV9hZnRlcl91cGxvYWQ6IElmIFRydWUsIHZlcmlmeSBlYWNoIGZpbGUgYWZ0ZXIgdXBsb2FkCiAgICAgICAgICAgIG9uX3ZlcmlmaWNhdGlvbl9mYWlsdXJlOiBPcHRpb25hbCBjYWxsYmFjayBmdW5jdGlvbihmaWxlX3BhdGgpIGNhbGxlZCB3aGVuIHZlcmlmaWNhdGlvbiBmYWlscwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rpb25hcnkgbWFwcGluZyBmaWxlIHBhdGhzIHRvIHN1Y2Nlc3Mgc3RhdHVzCiAgICAgICAgIiIiCiAgICAgICAgcmVzdWx0cyA9IHt9CiAgICAgICAgCiAgICAgICAgZm9yIHBob3RvX3BhdGggaW4gdHFkbShwaG90b19wYXRocywgZGVzYz0iVXBsb2FkaW5nIHBob3RvcyIpOgogICAgICAgICAgICBzdWNjZXNzID0gc2VsZi51cGxvYWRfcGhvdG8ocGhvdG9fcGF0aCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVmVyaWZ5IHVwbG9hZCBpZiByZXF1ZXN0ZWQKICAgICAgICAgICAgaWYgc3VjY2VzcyBhbmQgdmVyaWZ5X2FmdGVyX3VwbG9hZDoKICAgICAgICAgICAgICAgIHZlcmlmaWVkID0gc2VsZi52ZXJpZnlfZmlsZV91cGxvYWRlZChwaG90b19wYXRoKQogICAgICAgICAgICAgICAgaWYgbm90IHZlcmlmaWVkOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJVcGxvYWQgdmVyaWZpY2F0aW9uIGZhaWxlZCBmb3IgezB9Ii5mb3JtYXQocGhvdG9fcGF0aC5uYW1lKSkKICAgICAgICAgICAgICAgICAgICBpZiBvbl92ZXJpZmljYXRpb25fZmFpbHVyZToKICAgICAgICAgICAgICAgICAgICAgICAgb25fdmVyaWZpY2F0aW9uX2ZhaWx1cmUocGhvdG9fcGF0aCkKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIHJlc3VsdHNbcGhvdG9fcGF0aF0gPSBzdWNjZXNzCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFJhdGUgbGltaXRpbmcKICAgICAgICAgICAgdGltZS5zbGVlcCgwLjUpCiAgICAgICAgCiAgICAgICAgc3VjY2Vzc2Z1bCA9IHN1bSgxIGZvciB2IGluIHJlc3VsdHMudmFsdWVzKCkgaWYgdikKICAgICAgICBsb2dnZXIuaW5mbygiVXBsb2FkZWQgezB9L3sxfSBwaG90b3MiLmZvcm1hdChzdWNjZXNzZnVsLCBsZW4ocmVzdWx0cykpKQogICAgICAgIAogICAgICAgIHJldHVybiByZXN1bHRzCiAgICAKICAgIGRlZiB1cGxvYWRfdmlkZW8oc2VsZiwgdmlkZW9fcGF0aDogUGF0aCkgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBVcGxvYWQgYSBzaW5nbGUgdmlkZW8gdG8gaUNsb3VkIFBob3Rvcy4KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICB2aWRlb19wYXRoOiBQYXRoIHRvIHZpZGVvIGZpbGUKICAgICAgICAKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICBUcnVlIGlmIHN1Y2Nlc3NmdWwsIEZhbHNlIG90aGVyd2lzZQogICAgICAgICIiIgogICAgICAgICMgU2ltaWxhciB0byBwaG90byB1cGxvYWQgLSBtYXkgbm90IGJlIGRpcmVjdGx5IHN1cHBvcnRlZAogICAgICAgIGxvZ2dlci53YXJuaW5nKCJWaWRlbyB1cGxvYWQgbWF5IG5vdCBiZSBzdXBwb3J0ZWQ6IHswfSIuZm9ybWF0KHZpZGVvX3BhdGgubmFtZSkpCiAgICAgICAgcmV0dXJuIEZhbHNlCgoKY2xhc3MgaUNsb3VkUGhvdG9zU3luY1VwbG9hZGVyOgogICAgIiIiCiAgICBBbHRlcm5hdGl2ZSB1cGxvYWRlciB1c2luZyBQaG90b3MgbGlicmFyeSBzeW5jIG1ldGhvZC4KICAgIAogICAgVGhpcyBhcHByb2FjaCBjb3BpZXMgZmlsZXMgdG8gdGhlIFBob3RvcyBsaWJyYXJ5IGRpcmVjdG9yeSwKICAgIHdoaWNoIHRoZW4gc3luY3MgdG8gaUNsb3VkIFBob3RvcyBhdXRvbWF0aWNhbGx5LgogICAgIiIiCiAgICAKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBwaG90b3NfbGlicmFyeV9wYXRoOiBPcHRpb25hbFtQYXRoXSA9IE5vbmUpOgogICAgICAgICIiIgogICAgICAgIEluaXRpYWxpemUgdGhlIHN5bmMtYmFzZWQgdXBsb2FkZXIuCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgcGhvdG9zX2xpYnJhcnlfcGF0aDogUGF0aCB0byBQaG90b3MgbGlicmFyeSAoZGVmYXVsdHMgdG8gbWFjT1MgZGVmYXVsdCkKICAgICAgICAiIiIKICAgICAgICBpZiBwaG90b3NfbGlicmFyeV9wYXRoIGlzIE5vbmU6CiAgICAgICAgICAgICMgRGVmYXVsdCBtYWNPUyBQaG90b3MgbGlicmFyeSBsb2NhdGlvbgogICAgICAgICAgICBob21lID0gUGF0aC5ob21lKCkKICAgICAgICAgICAgc2VsZi5waG90b3NfbGlicmFyeV9wYXRoID0gaG9tZSAvICJQaWN0dXJlcyIgLyAiUGhvdG9zIExpYnJhcnkucGhvdG9zbGlicmFyeSIKICAgICAgICBlbHNlOgogICAgICAgICAgICBzZWxmLnBob3Rvc19saWJyYXJ5X3BhdGggPSBwaG90b3NfbGlicmFyeV9wYXRoCiAgICAgICAgCiAgICAgICAgIyBQaG90b3MgbGlicmFyeSBzdHJ1Y3R1cmUKICAgICAgICBzZWxmLm1hc3RlcnNfcGF0aCA9IHNlbGYucGhvdG9zX2xpYnJhcnlfcGF0aCAvICJNYXN0ZXJzIgogICAgICAgIAogICAgICAgIGxvZ2dlci5pbmZvKCJVc2luZyBQaG90b3MgbGlicmFyeTogezB9Ii5mb3JtYXQoc2VsZi5waG90b3NfbGlicmFyeV9wYXRoKSkKICAgIAogICAgZGVmIHVwbG9hZF9maWxlKHNlbGYsIGZpbGVfcGF0aDogUGF0aCwgYWxidW1fbmFtZTogT3B0aW9uYWxbc3RyXSA9IE5vbmUpIC0+IGJvb2w6CiAgICAgICAgIiIiCiAgICAgICAgQ29weSBmaWxlIHRvIFBob3RvcyBsaWJyYXJ5IGZvciBzeW5jLgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGZpbGVfcGF0aDogUGF0aCB0byBtZWRpYSBmaWxlCiAgICAgICAgICAgIGFsYnVtX25hbWU6IE9wdGlvbmFsIGFsYnVtIG5hbWUgKG5vdCBkaXJlY3RseSBzdXBwb3J0ZWQpCiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgVHJ1ZSBpZiBzdWNjZXNzZnVsLCBGYWxzZSBvdGhlcndpc2UKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgQ3JlYXRlIE1hc3RlcnMgZGlyZWN0b3J5IGlmIGl0IGRvZXNuJ3QgZXhpc3QKICAgICAgICAgICAgc2VsZi5tYXN0ZXJzX3BhdGgubWtkaXIocGFyZW50cz1UcnVlLCBleGlzdF9vaz1UcnVlKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBPcmdhbml6ZSBieSBkYXRlICh5ZWFyL21vbnRoKQogICAgICAgICAgICAjIFRoaXMgaGVscHMgUGhvdG9zIGFwcCBvcmdhbml6ZSBmaWxlcwogICAgICAgICAgICBpbXBvcnQgc2h1dGlsCiAgICAgICAgICAgIGZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRyeSB0byBnZXQgZGF0ZSBmcm9tIGZpbGUgbWV0YWRhdGEKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZnJvbSBQSUwgaW1wb3J0IEltYWdlCiAgICAgICAgICAgICAgICBmcm9tIFBJTC5FeGlmVGFncyBpbXBvcnQgREFURVRJTUUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaW1nID0gSW1hZ2Uub3BlbihmaWxlX3BhdGgpCiAgICAgICAgICAgICAgICBleGlmID0gaW1nLl9nZXRleGlmKCkKICAgICAgICAgICAgICAgIGlmIGV4aWY6CiAgICAgICAgICAgICAgICAgICAgZGF0ZV9zdHIgPSBleGlmLmdldChEQVRFVElNRSkKICAgICAgICAgICAgICAgICAgICBpZiBkYXRlX3N0cjoKICAgICAgICAgICAgICAgICAgICAgICAgZHQgPSBkYXRldGltZS5zdHJwdGltZShkYXRlX3N0ciwgIiVZOiVtOiVkICVIOiVNOiVTIikKICAgICAgICAgICAgICAgICAgICAgICAgeWVhciA9IGR0LnllYXIKICAgICAgICAgICAgICAgICAgICAgICAgbW9udGggPSBkdC5tb250aAogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHllYXIgPSBkYXRldGltZS5ub3coKS55ZWFyCiAgICAgICAgICAgICAgICAgICAgICAgIG1vbnRoID0gZGF0ZXRpbWUubm93KCkubW9udGgKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgeWVhciA9IGRhdGV0aW1lLm5vdygpLnllYXIKICAgICAgICAgICAgICAgICAgICBtb250aCA9IGRhdGV0aW1lLm5vdygpLm1vbnRoCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHllYXIgPSBkYXRldGltZS5ub3coKS55ZWFyCiAgICAgICAgICAgICAgICBtb250aCA9IGRhdGV0aW1lLm5vdygpLm1vbnRoCiAgICAgICAgICAgIAogICAgICAgICAgICAjIENyZWF0ZSB5ZWFyL21vbnRoIGRpcmVjdG9yeQogICAgICAgICAgICB0YXJnZXRfZGlyID0gc2VsZi5tYXN0ZXJzX3BhdGggLyBzdHIoeWVhcikgLyAiIHswfSIuZm9ybWF0KG1vbnRoKQogICAgICAgICAgICB0YXJnZXRfZGlyLm1rZGlyKHBhcmVudHM9VHJ1ZSwgZXhpc3Rfb2s9VHJ1ZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ29weSBmaWxlCiAgICAgICAgICAgIHRhcmdldF9wYXRoID0gdGFyZ2V0X2RpciAvIGZpbGVfcGF0aC5uYW1lCiAgICAgICAgICAgIHNodXRpbC5jb3B5MihmaWxlX3BhdGgsIHRhcmdldF9wYXRoKQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJDb3BpZWQgezB9IHRvIFBob3RvcyBsaWJyYXJ5Ii5mb3JtYXQoZmlsZV9wYXRoLm5hbWUpKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiRmFpbGVkIHRvIGNvcHkgezB9OiB7MX0iLmZvcm1hdChmaWxlX3BhdGgubmFtZSwgZSkpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgdmVyaWZ5X2ZpbGVfdXBsb2FkZWQoc2VsZiwgZmlsZV9wYXRoOiBQYXRoKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIFZlcmlmeSB0aGF0IGEgZmlsZSB3YXMgc3VjY2Vzc2Z1bGx5IHVwbG9hZGVkIHRvIGlDbG91ZCBQaG90b3MuCiAgICAgICAgCiAgICAgICAgRm9yIHN5bmMgbWV0aG9kLCB0aGlzIGNoZWNrcyBpZiB0aGUgZmlsZSBleGlzdHMgaW4gdGhlIFBob3RvcyBsaWJyYXJ5LgogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGZpbGVfcGF0aDogUGF0aCB0byB0aGUgb3JpZ2luYWwgZmlsZQogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIFRydWUgaWYgZmlsZSBpcyB2ZXJpZmllZCB0byBiZSB1cGxvYWRlZCwgRmFsc2Ugb3RoZXJ3aXNlCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUcnkgdG8gZ2V0IGRhdGUgZnJvbSBmaWxlIG1ldGFkYXRhIHRvIGZpbmQgdGFyZ2V0IGxvY2F0aW9uCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGZyb20gUElMIGltcG9ydCBJbWFnZQogICAgICAgICAgICAgICAgZnJvbSBQSUwuRXhpZlRhZ3MgaW1wb3J0IERBVEVUSU1FCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGltZyA9IEltYWdlLm9wZW4oZmlsZV9wYXRoKQogICAgICAgICAgICAgICAgZXhpZiA9IGltZy5fZ2V0ZXhpZigpCiAgICAgICAgICAgICAgICBpZiBleGlmOgogICAgICAgICAgICAgICAgICAgIGRhdGVfc3RyID0gZXhpZi5nZXQoREFURVRJTUUpCiAgICAgICAgICAgICAgICAgICAgaWYgZGF0ZV9zdHI6CiAgICAgICAgICAgICAgICAgICAgICAgIGR0ID0gZGF0ZXRpbWUuc3RycHRpbWUoZGF0ZV9zdHIsICIlWTolbTolZCAlSDolTTolUyIpCiAgICAgICAgICAgICAgICAgICAgICAgIHllYXIgPSBkdC55ZWFyCiAgICAgICAgICAgICAgICAgICAgICAgIG1vbnRoID0gZHQubW9udGgKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICB5ZWFyID0gZGF0ZXRpbWUubm93KCkueWVhcgogICAgICAgICAgICAgICAgICAgICAgICBtb250aCA9IGRhdGV0aW1lLm5vdygpLm1vbnRoCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHllYXIgPSBkYXRldGltZS5ub3coKS55ZWFyCiAgICAgICAgICAgICAgICAgICAgbW9udGggPSBkYXRldGltZS5ub3coKS5tb250aAogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICB5ZWFyID0gZGF0ZXRpbWUubm93KCkueWVhcgogICAgICAgICAgICAgICAgbW9udGggPSBkYXRldGltZS5ub3coKS5tb250aAogICAgICAgICAgICAKICAgICAgICAgICAgIyBDaGVjayBpZiBmaWxlIGV4aXN0cyBpbiBQaG90b3MgbGlicmFyeQogICAgICAgICAgICB0YXJnZXRfZGlyID0gc2VsZi5tYXN0ZXJzX3BhdGggLyBzdHIoeWVhcikgLyAiIHswfSIuZm9ybWF0KG1vbnRoKQogICAgICAgICAgICB0YXJnZXRfcGF0aCA9IHRhcmdldF9kaXIgLyBmaWxlX3BhdGgubmFtZQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgdGFyZ2V0X3BhdGguZXhpc3RzKCk6CiAgICAgICAgICAgICAgICAjIEFsc28gdmVyaWZ5IGZpbGUgc2l6ZSBtYXRjaGVzIChiYXNpYyBpbnRlZ3JpdHkgY2hlY2spCiAgICAgICAgICAgICAgICBpZiB0YXJnZXRfcGF0aC5zdGF0KCkuc3Rfc2l6ZSA9PSBmaWxlX3BhdGguc3RhdCgpLnN0X3NpemU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiRXJyb3IgdmVyaWZ5aW5nIGZpbGUgezB9OiB7MX0iLmZvcm1hdChmaWxlX3BhdGgubmFtZSwgZSkpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgdXBsb2FkX2ZpbGVzX2JhdGNoKHNlbGYsIGZpbGVfcGF0aHM6IExpc3RbUGF0aF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsYnVtczogT3B0aW9uYWxbRGljdFtQYXRoLCBzdHJdXSA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyaWZ5X2FmdGVyX3VwbG9hZDogYm9vbCA9IFRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgb25fdmVyaWZpY2F0aW9uX2ZhaWx1cmU6IE9wdGlvbmFsW0NhbGxhYmxlW1tQYXRoXSwgTm9uZV1dID0gTm9uZSkgLT4gRGljdFtQYXRoLCBib29sXToKICAgICAgICAiIiIKICAgICAgICBVcGxvYWQgbXVsdGlwbGUgZmlsZXMgaW4gYSBiYXRjaC4KICAgICAgICAKICAgICAgICBBcmdzOgogICAgICAgICAgICBmaWxlX3BhdGhzOiBMaXN0IG9mIGZpbGUgcGF0aHMKICAgICAgICAgICAgYWxidW1zOiBPcHRpb25hbCBtYXBwaW5nIG9mIGZpbGVzIHRvIGFsYnVtIG5hbWVzCiAgICAgICAgICAgIHZlcmlmeV9hZnRlcl91cGxvYWQ6IElmIFRydWUsIHZlcmlmeSBlYWNoIGZpbGUgYWZ0ZXIgdXBsb2FkCiAgICAgICAgICAgIG9uX3ZlcmlmaWNhdGlvbl9mYWlsdXJlOiBPcHRpb25hbCBjYWxsYmFjayBmdW5jdGlvbihmaWxlX3BhdGgpIGNhbGxlZCB3aGVuIHZlcmlmaWNhdGlvbiBmYWlscwogICAgICAgIAogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIERpY3Rpb25hcnkgbWFwcGluZyBmaWxlIHBhdGhzIHRvIHN1Y2Nlc3Mgc3RhdHVzCiAgICAgICAgIiIiCiAgICAgICAgcmVzdWx0cyA9IHt9CiAgICAgICAgCiAgICAgICAgZm9yIGZpbGVfcGF0aCBpbiB0cWRtKGZpbGVfcGF0aHMsIGRlc2M9IkNvcHlpbmcgdG8gUGhvdG9zIGxpYnJhcnkiKToKICAgICAgICAgICAgYWxidW1fbmFtZSA9IGFsYnVtcy5nZXQoZmlsZV9wYXRoKSBpZiBhbGJ1bXMgZWxzZSBOb25lCiAgICAgICAgICAgIHN1Y2Nlc3MgPSBzZWxmLnVwbG9hZF9maWxlKGZpbGVfcGF0aCwgYWxidW1fbmFtZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVmVyaWZ5IHVwbG9hZCBpZiByZXF1ZXN0ZWQKICAgICAgICAgICAgaWYgc3VjY2VzcyBhbmQgdmVyaWZ5X2FmdGVyX3VwbG9hZDoKICAgICAgICAgICAgICAgIHZlcmlmaWVkID0gc2VsZi52ZXJpZnlfZmlsZV91cGxvYWRlZChmaWxlX3BhdGgpCiAgICAgICAgICAgICAgICBpZiBub3QgdmVyaWZpZWQ6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIlVwbG9hZCB2ZXJpZmljYXRpb24gZmFpbGVkIGZvciB7MH0iLmZvcm1hdChmaWxlX3BhdGgubmFtZSkpCiAgICAgICAgICAgICAgICAgICAgaWYgb25fdmVyaWZpY2F0aW9uX2ZhaWx1cmU6CiAgICAgICAgICAgICAgICAgICAgICAgIG9uX3ZlcmlmaWNhdGlvbl9mYWlsdXJlKGZpbGVfcGF0aCkKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIHJlc3VsdHNbZmlsZV9wYXRoXSA9IHN1Y2Nlc3MKICAgICAgICAKICAgICAgICBzdWNjZXNzZnVsID0gc3VtKDEgZm9yIHYgaW4gcmVzdWx0cy52YWx1ZXMoKSBpZiB2KQogICAgICAgIGxvZ2dlci5pbmZvKCJDb3BpZWQgezB9L3sxfSBmaWxlcyB0byBQaG90b3MgbGlicmFyeSIuZm9ybWF0KHN1Y2Nlc3NmdWwsIGxlbihyZXN1bHRzKSkpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIHJlc3VsdHMK"""

if __name__ == "__main__":
    # Decode and write the file
    content = base64.b64decode(ENCODED_CONTENT).decode('utf-8')
    with open('icloud_uploader.py', 'w') as f:
        f.write(content)
    print("âœ“ Successfully created icloud_uploader.py")
    print(f"  File size: {len(content)} bytes")
    print(f"  Lines: {len(content.splitlines())}")

